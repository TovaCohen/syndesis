[id='add-template-step_{context}']
= Add a template step

In an integration, a template step takes data from a source and 
inserts it into the format that is defined in a template that you upload to {prodname}.
The benefit of a template step is that it provides data output in a 
consistent format that you specify. 

The template defines placeholders and can also specify static text. 
When you create the integration, you add a template step, map source fields 
to the template placeholders, and then map template content to the next step 
in the integration. When the integration executes, {prodname}
inserts the values that are in the mapped source fields into an
instance of the template and passes the result to the next step in the integration.

In this release, only https://mustache.github.io[Mustache] templates are
supported. It is expected that 
https://velocity.apache.org[Velocity] and
https://freemarker.apache.org[Freemarker] templates will be supported
in a future release. 

.Prerequisites
* You must be creating or editing an integration. If you are creating an
integration then it must already have its start and finish connections.
* If you plan to upload a template then you must be able to navigate to it.
Alternatively, you can create the template when you add the template step.

.Procedure

. In the integration visualization panel on the left, hover over the
image:images/PlusSignToAddStepOrConnection.png[Plus Sign]
at the location where you want to add a template step.
. In the popup, click *Add a Step*.
. On the *Choose a Step* page, click *Template*. This displays the 
*Upload Template* page, which prompts you to choose how you want to define 
the template. 

. Do one of the following:

* Drag and drop a template file or a file that contains text that you
want to modify to create a template, into the template editor. 
* Click *browse to upload*, navigate to a file, and upload it. 
* In the template editor, start typing to define a template.

. In the template editor, ensure that the content defines a valid
template. {prodname} displays 
image:images/RedCircleXError.png[a red error indicator] to the left of
a line that contains a syntax error. Hover over the red indicator for hints
about how to resolve the error. Here is an example of a valid template:
+
----
At {{body.time}}, {{body.name}} tweeted:
{{body.text}}
----

. Click *Done* to add the template step to the integration.
+ 
If the *Done* button is not enabled then there is at least one syntax error 
in the template. You must correct the error before you can add this 
Template step to the integration. 
+
Input to a template step must be in the form of a JSON object so a data
mapping step is required before a template step
. Add a data mapper step before the template step:
.. In the left panel, hover over the  
image:images/PlusSignToAddStepOrConnection.png[Plus Sign] that is 
immediately before the template step you just added and click *Add a Step*. 
.. On the *Choose a Step* page, click *Data Mapper*.
.. In the data mapper, map a source field to each template placeholder field. 
+
For example, using the template above, you would map a source field 
to each of these template fields:
+
* `body.time`
* `body.name`
* `body.text`
.. In the upper right, click *Done* to add the data mapper step to the 
integration.

+
Output from a template step is always a JSON object so a data mapper step
is required after a template step.
. Add a data mapper step after the template step:
.. In the left panel, hover over the  
image:images/PlusSignToAddStepOrConnection.png[Plus Sign] that is 
immediately after the template step you just added and click *Add a Step*. 
.. On the *Choose a Step* page, click *Data Mapper*.
.. In the data mapper, map the template's *message* field, which 
always contains the result of inserting source fields into the
template, to a target field. For example, suppose that a Gmail connection is 
next in the integration and you want to send the result of the template step
as the content of a Gmail message. To do this, you would map the *message* 
source field to the *text* target field.
.. In the upper right, click *Done*. 


.Additional resources

* For details about mapping fields, see <<mapping-data>>. 
* https://mustache.github.io/mustache.5.html[Mustache Manual]
